import{h}from"./QItem.87f7eb07.js";import{H as g,Q as y}from"./HeaderActions.f25c2299.js";import{F as f}from"./FormComponent.f412702e.js";import{_ as b,d as q,r as t,aW as n,s as l,a as d,o as A,c as E,w as c,e as u,f as a}from"./index.650196fd.js";import"./BtnAction.b0c7cc86.js";import"./QInput.d6ff27b1.js";import"./notification.e1842625.js";import"./warning.551030d0.js";import"./bms.bfdce8d2.js";import"./tecnical_support.43e3eec1.js";import"./QSpinnerPie.7f041fe1.js";import"./QForm.85481701.js";import"./use-fullscreen.0a2c208b.js";import"./QChip.f7831cda.js";import"./QDate.8a7cc956.js";import"./SelectComponent.2f5249cd.js";import"./QEditor.0b50cedd.js";const C=q({key:"AddEquipment",components:{HeaderActions:g,FormComponent:f},data(){return{loading:!1,localCategories:[],originalEquipment:null,btnAction:{show:!0,btnTitle:"Guardar",iconName:"o_save",btnWidth:"auto",tooltip:"Guardar equipo",btnAction:this.createOrEdit,loader:!1},btnCloseWindow:{iconName:"exit_to_app",btnBackground:"#FF990020",btnColor:"#FF9900",btnAction:this.goBack},fields:{id:null,createdAt:this.getCreatedAt(),top:[{key:"CategoryId",label:"Categor\xEDa del equipo*",type:"autocomplete",itemFilter:this.filterCategories,setModel:this.setModelCategory,options:[],model:null,shouldShow:!this.isEditing(),rules:[t.requiredAutocomplete]},{key:"categoryName",label:"Categor\xEDa del equipo*",model:"",shouldShow:this.isEditing(),readonly:!0},{key:"LocationId",label:"Ubicaci\xF3n*",type:"autocomplete",model:null,itemFilter:this.filterLocations,setModel:this.setModelLocation,options:[],rules:[t.requiredAutocomplete]}],left:[{key:"equipmentModel",label:"Modelo del equipo*",model:"",readonly:this.isEditing(),rules:[t.requiredString,t.maxLength(60),t.alphanumeric]},{key:"serialNumber",label:"N\xFAmero de serie*",model:"",readonly:this.isEditing(),rules:[t.requiredString,t.maxLength(30),t.alphanumeric]},{key:"equipmentBrand",label:"Marca*",model:"",readonly:this.isEditing(),rules:[t.requiredString,t.maxLength(60),t.alphanumeric]},{key:"manufacturingYear",label:"A\xF1o del equipo*",type:"number",readonly:this.isEditing(),rules:[t.validYear,t.validateYearNotGreaterThanCurrent,t.validateYearNotLessThan100YearsAgo],model:""},{key:"nextMaintenanceDate",label:"Pr\xF3ximo mantenimiento",type:"date",model:"",readonly:!0,shouldShow:this.isEditing()},{key:"equipmentStatus",label:"Estatus*",type:"select",model:null,shouldShow:this.isEditing(),options:[{label:"Activo",index:1,value:1},{label:"Inactivo",index:2,value:0}]},{key:"provider",label:"Proveedor",model:"",rules:[t.maxLength(50),t.alphanumeric]},{key:"price",label:"Costo",model:"",prefix:"$",type:"number",rules:[t.numeric,t.nonNegative,t.maxDecimalPlaces]},{key:"warrantyDate",label:"Fecha de garant\xEDa",type:"date",model:""},{key:"acquisitionDate",label:"Fecha de adquisici\xF3n",type:"date",model:""}],right:[{key:"photo",imageInput:!0,model:null}],bottom:[{key:"observations",type:"textarea",label:"Observaciones del equipo",required:!1,model:""}]}}},methods:{async initInfo(){this.loading=!0,await this.getLocations(),this.isEditing()?await this.getEquipment():(await this.getCategories(),this.loading=!1)},async createOrEdit(){await this.$refs.fieldsComponent.validate()&&(this.isEditing()?this.editEquipment():this.createEquipment())},async createEquipment(){this.btnAction.loader=!0;try{await this.$store.dispatch("equipments/postEquipmentAction",this.fields)===!0?(n(this.$q,{title:"\xC9xito al crear el equipo",msg:"El equipo se ha agregado"}),this.$router.go(-1)):l(this.$q,{msg:"Int\xE9ntalo de nuevo m\xE1s tarde y si el error persiste, rep\xF3rtalo"}),this.btnAction.loader=!1}catch{this.btnAction.loader=!1}},async getEquipment(){try{const e={id:this.$route.params.id,fields:this.fields};this.originalEquipment=await this.$store.dispatch("equipments/getEquipmentAction",e),this.loading=!1}catch(e){console.log(e),this.loading=!1}},async editEquipment(){this.btnAction.loader=!0;try{this.fields.id=this.$route.params.id,this.fields.originalObj=this.originalEquipment,await this.$store.dispatch("equipments/updateEquipmentAction",this.fields)===!0?(n(this.$q,{title:"\xC9xito al editar el equipo",msg:"El equipo se ha actualizado"}),this.$router.go(-1)):l(this.$q,{msg:"Int\xE9ntalo de nuevo m\xE1s tarde y si el error persiste, rep\xF3rtalo"}),this.btnAction.loader=!1}catch{this.btnAction.loader=!1}},async getCategories(){try{await this.$store.dispatch("equipments/getAllCategoriesAction"),this.updateFieldByKeyInAllArrays("CategoryId",{options:JSON.parse(JSON.stringify(this.categories))})}catch(e){console.log(e)}},async getLocations(){try{await this.$store.dispatch("equipments/getAllLocationsAction"),this.updateFieldByKeyInAllArrays("LocationId",{options:JSON.parse(JSON.stringify(this.locations))})}catch(e){console.log(e)}},updateFieldByKeyInAllArrays(e,i){for(const o in this.fields)if(Array.isArray(this.fields[o])){const s=this.fields[o].find(r=>r.key===e);if(s){Object.assign(s,i);return}}console.error(`No se encontr\xF3 la entrada para la clave '${e}' en ning\xFAn arreglo o no tiene opciones.`)},getTitle(){return this.isEditing()?"Editar equipo":"Agregar equipo"},getCreatedAt(){return this.isEditing()?"":this.$store.getters["global/getDate"]},goBack(){this.$router.go(-1)},getDate(){return this.$store.$store.getters["global/getDate"]},isEditing(){return!!this.$route.params.id},filterCategories(e,i){if(e===""){i(()=>{this.updateFieldByKeyInAllArrays("CategoryId",{options:this.categories})});return}i(()=>{const o=e.toLowerCase();this.updateFieldByKeyInAllArrays("CategoryId",{options:this.categories.filter(s=>this.removeAccents(s.label.toLowerCase()).includes(this.removeAccents(o)))})})},removeAccents(e){return e.normalize("NFD").replace(/[\u0300-\u036f]/g,"")},filterLocations(e,i){if(e===""){i(()=>{this.updateFieldByKeyInAllArrays("LocationId",{options:this.locations})});return}i(()=>{const o=e.toLowerCase();this.updateFieldByKeyInAllArrays("LocationId",{options:this.locations.filter(s=>this.removeAccents(s.label.toLowerCase()).includes(this.removeAccents(o)))})})},setModelCategory(e){const i=this.categories.find(o=>o.categoryName===e);this.updateFieldByKeyInAllArrays("CategoryId",{model:i||e})},setModelLocation(e){const i=this.locations.find(o=>o.locationName===e);this.updateFieldByKeyInAllArrays("LocationId",{model:i||e})}},computed:{equipments(){return this.$store.getters["equipments/getEquipmentsGetter"]},categories(){return this.$store.getters["equipments/getCategoriesGetter"]},locations(){return this.$store.getters["equipments/getLocationsGetter"]}},created(){this.initInfo()}}),w={class:"card-page"},_={class:"main-container-page main-container-page-medium-dark container-form"};function $(e,i,o,s,r,v){const p=d("header-actions"),m=d("form-component");return A(),E(y,{class:"flex flex-center cursor-pointer non-selectable"},{default:c(()=>[u("div",w,[a(p,{titlePage:e.getTitle(),"btn-action":e.btnAction,"btn-close-window":e.btnCloseWindow},null,8,["titlePage","btn-action","btn-close-window"]),u("div",_,[a(h,{class:"h-97 q-pa-xs-none q-pa-lg-sm","thumb-style":e.$store.getters["global/getThumbStyle"]},{default:c(()=>[a(m,{ref:"fieldsComponent",loading:e.loading,fields:e.fields},null,8,["loading","fields"])]),_:1},8,["thumb-style"])])])]),_:1})}var J=b(C,[["render",$],["__scopeId","data-v-56ead9bc"]]);export{J as default};
