import{Q as f}from"./QSpinnerPie.7f041fe1.js";import{h as b}from"./QItem.87f7eb07.js";import{Q as w}from"./QPagination.5f7621cf.js";import{H as P,Q as q}from"./HeaderActions.f25c2299.js";import{G as y}from"./GeneralTable.329fea1a.js";import{I as S}from"./ItemCard.0c2ebc42.js";import{_ as T,d as C,a as l,o,c as d,w as u,e as n,f as s,a7 as $,a6 as r,an as E,am as A,a9 as M,a8 as c,ao as F}from"./index.650196fd.js";import"./BtnAction.b0c7cc86.js";import"./QInput.d6ff27b1.js";import"./use-fullscreen.0a2c208b.js";import"./QChip.f7831cda.js";import"./QCard.9e15fa18.js";const R=C({name:"ReportsPage",components:{HeaderActions:P,GeneralTable:y,ItemCard:S},data(){return{delaySearch:300,searchModel:null,timeoutSearch:null,loading:!0,switchContent:1,btnCloseWindow:{iconName:"exit_to_app",btnBackground:"#FF990020",btnColor:"#FF9900",btnAction:this.goBack},btnAction:{show:!0,btnTitle:"Agregar reporte",tooltip:"Agregar nuevo reporte",btnAction:this.goToAddReport,btnWidth:"auto"},actionsTable:[{icnName:"read_more",icnSize:"sm",icnAction:"Detail",tooltip:"Detalle de reporte"},{icnName:"engineering",icnSize:"xs",icnAction:"Maintenance",tooltip:"Atender reporte",hidden:!0}],rowSelected:{},selectedFilterText:"reason",inputSearch:{show:!0,inputLabel:"Buscar por reporte",setSelectedFilter:this.setSelectedFilter,setSelectedOptionFilter:this.setSelectedOptionFilter,heightModal:160,items:[{title:"Buscar por reporte",icon:"o_bug_report",filter:"reason"},{title:"Encargado",icon:"o_supervisor_account",filter:"userName"},{title:"Estatus",icon:"o_engineering",options:[{title:"Resuelto",filter:"reportStatus",value:"Resuelto"},{title:"Pendiente",filter:"reportStatus",value:"Pendiente"},{title:"Cancelado",filter:"reportStatus",value:"Cancelado"}]}]},params:{reason:""},columns:[{name:"reason",required:!0,label:"Motivo",align:"left",field:e=>e.reason,format:e=>`${e}`,sortable:!0},{name:"encharged_name",label:"Encargado",field:"encharged_name",align:"left",sortable:!0},{name:"badge-priority",label:"Prioridad",field:"reportUrgency",align:"left",sortable:!0},{name:"date",label:"Fecha del reporte",field:"date",align:"center",sortable:!0},{name:"badge",label:"Estatus",field:"status",align:"center",sortable:!0},{name:"actions",label:"Acciones",field:"actions",align:"center"}],localPagination:{totalPages:1,descending:!1,rowsPerPage:12,page:1}}},mounted(){this.$route.query.equipment?(this.params.IdEquipment=this.$route.query.equipment,this.btnAction.show=this.equipment.equipmentStatus):this.$route.query.user&&(this.params.userId=this.$route.query.user),this.getReports()},watch:{rowSelected:{handler(e){e.action==="Detail"?this.goToDetails(e.id):e.action==="Maintenance"&&this.goToMaintenance(e.id)},deep:!0},searchModel(e){this.params[this.selectedFilterText]=e,clearTimeout(this.timeoutSearch),this.timeoutSearch=setTimeout(()=>{this.params.page=1,this.getReports()},this.delaySearch)},selectedFilterText(){this.params.page=1}},computed:{reports:{get(){return this.$store.getters["reports/getReportsGetter"]}},pagination:{get(){return this.$store.getters["reports/getPaginationGetter"]}},equipment:{get(){return this.$store.getters["equipments/getEquipmentGetter"]}},cards(){return this.reports.map(e=>({id:e.id,cardTitle:e.reason,status:this.findIndicator(e.status),cardLabels:[{label:"Encargado",info:e.encharged_name},{label:"Prioridad",info:e.reportUrgency}]}))}},methods:{async getReports(){this.loading=!0,this.localPagination={...this.localPagination,...await this.$store.dispatch("reports/getReportsAction",this.params)},this.loading=!1},findIndicator(e){return e==="Pendiente"?{tooltip:"El reporte est\xE1 pendiente",color:"#FF9900",label:"Pendiente"}:e==="Cancelado"?{tooltip:"El reporte ha sido cancelado",color:"#dc4e5f",label:"Cancelado"}:{tooltip:"El reporte ha sido resuelto",color:"#1e65e8",label:"Resuelto"}},showCloseBtn(){return this.$route.query.equipment},goToAddReport(){this.$route.query.equipment||this.$store.commit("equipments/MUTATE_EQUIPMENT",null),this.$router.push({name:"add-report"})},goBack(){this.$router.go(-1)},goToDetails(e){this.$router.push({name:"detail-report",params:{id:e}})},async goToMaintenance(e){this.$store.commit("equipments/MUTATE_EQUIPMENT",null);const t=JSON.parse(JSON.stringify(this.reports.find(i=>i.id==e)));t.Equipment.categoryName+=` - ${t.Equipment.equipmentModel} - No. serie: ${t.Equipment.serialNumber}`,this.$store.commit("reports/MUTATE_REPORT",t),this.$router.push({name:"add-maintenance"})},goToEdit(e){this.$router.push({name:"edit-report",params:{id:e}})},setSelectedFilter(e){this.selectedFilterText&&(delete this.params[this.selectedFilterText],this.searchModel&&this.getReports()),this.selectedFilterText=e.filter,this.inputSearch.inputLabel=e.title,e.value&&e.filter&&(this.params[e.filter]=this.searchModel,this.getReports())},setSelectedOptionFilter(e,t=null){e.length&&e.forEach(i=>{this.params[i.filter]=i.value}),t&&delete this.params[t],this.params.page=1,this.getReports()},changePagination(e){this.localPagination.page=e,this.params={...this.params,page:this.localPagination.page,rowsPerPage:this.localPagination.rowsPerPage},this.getReports(this.params)}}}),N={class:"card-page"},k={style:{"max-width":"100%"}},v={key:0,class:"row container-cards"},U={key:1,class:"q-ma-md q-ma-sm-xl q-pa-xl text-center no-info border-rounded"},B=n("div",{class:"text-primary q-ma-lg"},"Cargando reportes",-1),_={key:2,class:"q-ma-md q-ma-sm-xl q-pa-xl text-center no-info border-rounded"},Q=n("strong",{class:"text-negative"},"!",-1),I={key:1,style:{height:"6.55%"},class:"row justify-center q-pt-sm"};function V(e,t,i,D,O,z){const m=l("header-actions"),h=l("item-card"),g=l("general-table");return o(),d(q,{class:"flex flex-center cursor-pointer non-selectable"},{default:u(()=>[n("div",N,[s(m,{titlePage:"Reportes",btnAction:e.btnAction,inputSearch:e.inputSearch,"btn-close-window":e.showCloseBtn()?e.btnCloseWindow:null,searchModel:e.searchModel,"onUpdate:searchModel":t[0]||(t[0]=a=>e.searchModel=a),"switch-content":e.switchContent,"onUpdate:switchContent":t[1]||(t[1]=a=>e.switchContent=a)},null,8,["btnAction","inputSearch","btn-close-window","searchModel","switch-content"]),n("div",{class:$(["main-container-page q-pa-sm",{"card-color main-container-page-dark":e.switchContent===1}])},[e.switchContent===1?(o(),d(b,{key:0,style:{height:"93% !important"},class:"fit","thumb-style":e.$store.getters["global/getThumbStyle"]},{default:u(()=>[n("div",k,[e.reports.length>0?(o(),r("div",v,[(o(!0),r(E,null,A(e.cards,(a,p)=>(o(),r("div",{key:p,class:"col-xs-12 col-sm-auto col-md-auto col-lg-auto col-xl-auto"},[s(h,F(a,{index:p,"card-action":e.goToDetails}),null,16,["index","card-action"])]))),128))])):e.loading?(o(),r("div",U,[s(f,{color:"primary",class:"q-mt-lg",size:"4em"}),B])):e.loading===!1?(o(),r("div",_,[M(" No hay reportes para mostrar "),Q])):c("",!0)])]),_:1},8,["thumb-style"])):c("",!0),e.switchContent===1&&e.reports.length>0?(o(),r("div",I,[s(w,{modelValue:e.localPagination.page,"onUpdate:modelValue":[t[2]||(t[2]=a=>e.localPagination.page=a),e.changePagination],dense:"",class:"q-mt-none pagination-style",max:e.localPagination.totalPages,size:"md","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])):e.switchContent===2?(o(),d(g,{key:2,"row-selected":e.rowSelected,"onUpdate:rowSelected":t[3]||(t[3]=a=>e.rowSelected=a),height:"100%",rows:e.reports,columns:e.columns,loading:e.loading,"actions-table":e.actionsTable,"pagination-prop":e.localPagination,onChangePagination:e.changePagination},null,8,["row-selected","rows","columns","loading","actions-table","pagination-prop","onChangePagination"])):c("",!0)],2)])]),_:1})}var te=T(R,[["render",V]]);export{te as default};
