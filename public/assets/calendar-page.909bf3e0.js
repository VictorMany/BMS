import{Q as h}from"./QDate.8a7cc956.js";import{Q as D}from"./QSpinnerPie.7f041fe1.js";import{h as v}from"./QItem.87f7eb07.js";import{H as M,B as P,Q as E}from"./HeaderActions.f25c2299.js";import{I as T}from"./ItemCard.0c2ebc42.js";import{G as S}from"./GeneralTable.329fea1a.js";import{_ as C,d as $,a as d,o as n,c,w as g,e as o,f as s,a6 as i,an as A,am as k,a9 as N,a8 as f,ao as U,p as B,i as V}from"./index.650196fd.js";import"./BtnAction.b0c7cc86.js";import"./QInput.d6ff27b1.js";import"./QChip.f7831cda.js";import"./QCard.9e15fa18.js";import"./QPagination.5f7621cf.js";import"./use-fullscreen.0a2c208b.js";const I=$({name:"CalendarPage",components:{HeaderActions:M,ItemCard:T,GeneralTable:S,BtnSwitch:P},data(){return{calendarModel:null,loading:!0,selectedFilter:"secondary",events:[],btnAction:{show:!0,tooltip:"Agregar nuevo plan",btnTitle:"Crear plan de mantenimientos",to:"add-maintenance-plan"},delaySearch:300,searchModel:null,showCards:!0,switchContent:1,timeoutSearch:null,localPagination:{},rowSelected:{},selectedFilterText:"name",params:{date:"2024-03-01"},columns:[{name:"equipment",required:!0,label:"Equipo",align:"left",field:"equipment",format:e=>`${e}`,sortable:!0},{name:"model",label:"Modelo",field:"model",align:"left",sortable:!0},{name:"no_serie",label:"No. serie",field:"no_serie",align:"center",sortable:!0},{name:"actions",label:"Acciones",field:"actions",align:"center"}],actionsTable:[{icnName:"read_more",icnSize:"sm",icnAction:"Detail",tooltip:"Detalle de equipo"},{icnName:"o_edit",icnSize:"xs",icnAction:"Edit",tooltip:"Editar equipo"},{icnName:"engineering",icnSize:"xs",icnAction:"Maintenance",tooltip:"Realizarle mantenimiento"}]}},created(){this.checkPermissions(),this.initInfo()},methods:{async initInfo(){this.calendarModel=this.formatDate();const e=new Date;await this.getDatesPerMonth({year:e.getFullYear(),month:e.getMonth()+1}),await this.getEquipmentsByDate()},async getDatesPerMonth(e){if(e){let t=e.year+"-"+e.month.toString().padStart(2,"0");const r=await this.$store.dispatch("equipments/getDatesPerMonthAction",t);this.events=r}},async getEquipmentsByDate(e=null){try{let t=e?e.replace(/-/g,"/"):this.formatDate().replace(/-/g,"/");this.loading=!0,this.events.includes(t)?(this.params.date=this.formatDate(e),await this.$store.dispatch("equipments/getEquipmentsByDateAction",this.params)):this.$store.commit("equipments/MUTATE_EQUIPMENTS",[]),this.loading=!1}catch(t){console.log(t),this.$store.commit("equipments/MUTATE_EQUIPMENTS",[])}},async goToMaintenance(e){this.$store.commit("equipments/MUTATE_EQUIPMENT",null),await this.getEquipment(e),this.$router.push({name:"add-maintenance"})},async getEquipment(e){await this.$store.dispatch("equipments/getEquipmentAction",{id:e})},checkPermissions(){switch(this.userRole){case 2:case 3:this.btnAction.show=!1;break}},formatDate(e){if(e)e=new Date(e);else{const l=new Date;e=new Date(l.getFullYear(),l.getMonth(),l.getDate())}const t=e.getUTCFullYear(),r=(e.getUTCMonth()+1).toString().padStart(2,"0"),p=e.getUTCDate().toString().padStart(2,"0");return`${t}-${r}-${p}`},goToDetails(e){this.$router.push({name:"detail-equipment",params:{id:e}})},goToEdit(e){this.$router.push({name:"edit-equipment",params:{id:e}})},changePagination(e){this.params={...this.params,page:e.page,rowsPerPage:e.rowsPerPage},this.getEquipmentsByDate()},changePaginationCards(e){this.params={...this.params,page:e,rowsPerPage:12},this.getEquipmentsByDate()}},watch:{rowSelected:{handler(e){e.action==="Edit"?this.goToEdit(e.id):e.action==="Detail"?this.goToDetails(e.id):e.action==="Maintenance"&&this.goToMaintenance(e.id)},deep:!0}},computed:{equipments(){return this.$store.getters["equipments/getEquipmentsGetter"]},rows(){return this.equipments.map(e=>({id:e.id,equipment:e.cardTitle,model:e.cardLabels[0].info,no_serie:e.cardLabels[1].info,date:e.cardDate}))},pagination:{get(){return this.$store.getters["equipments/getPaginationGetter"]}},userRole:{get(){return this.$store.getters["users/getRoleGetter"]}}}}),m=e=>(B("data-v-5fd193ff"),e=e(),V(),e),Y={class:"card-page"},F={class:"main-container-page main-container-page-medium-dark bg-grey-3 row h-90 q-pa-md-md"},Q={class:"col-xs-12 col-md-auto"},x={class:"col-md col-12 q-px-sm h-90"},R={class:"row flex items-center justify-between q-mb-sm q-pa-xs-md"},z=m(()=>o("div",{class:"form__item-label text-weight-thin col"}," Selecciona una fecha resaltada en el Calendario de mantenimientos y podr\xE1s ver los equipos con mantenimientos programados ",-1)),G={style:{overflow:"scroll"},class:"row q-pa-none q-px-md-md q-ma-none h-90 w-100"},L={style:{"max-width":"100%"}},H={key:0,class:"row q-pa-none q-ma-none"},j={key:1,class:"q-ma-sm-xl q-pa-xl text-center no-info border-rounded"},J=m(()=>o("div",{class:"text-primary q-ma-lg"},"Cargando equipos",-1)),K={key:2,class:"q-ma-sm-xl q-pa-xl text-center no-info border-rounded"},O=m(()=>o("strong",{class:"text-negative"},"!",-1));function W(e,t,r,p,w,l){const q=d("header-actions"),b=d("btn-switch"),y=d("item-card"),_=d("general-table");return n(),c(E,{class:"flex flex-center cursor-pointer non-selectable"},{default:g(()=>[o("div",Y,[s(q,{titlePage:"Calendario de mantenimientos",btnAction:e.btnAction},null,8,["btnAction"]),o("div",F,[o("div",Q,[s(h,{modelValue:e.calendarModel,"onUpdate:modelValue":[t[0]||(t[0]=a=>e.calendarModel=a),e.getEquipmentsByDate],"today-btn":"",color:"primary",mask:"YYYY-MM-DD",class:"text-blue-blue-grey-4 border-line border-rounded gt-xs form__date_container",landscape:"",events:e.events,onNavigation:e.getDatesPerMonth},null,8,["modelValue","events","onUpdate:modelValue","onNavigation"]),s(h,{modelValue:e.calendarModel,"onUpdate:modelValue":[t[1]||(t[1]=a=>e.calendarModel=a),e.getEquipmentsByDate],"today-btn":"",color:"primary",mask:"YYYY-MM-DD",class:"text-blue-blue-grey-4 border-line border-rounded lt-sm w-100 form__date_container",events:e.events,onNavigation:e.getDatesPerMonth},null,8,["modelValue","events","onUpdate:modelValue","onNavigation"])]),o("div",x,[o("div",R,[z,s(b,{class:"col-auto","switch-content":e.switchContent,"onUpdate:switchContent":t[2]||(t[2]=a=>e.switchContent=a)},null,8,["switch-content"])]),o("div",G,[e.switchContent===1?(n(),c(v,{key:0,class:"fit h-100","thumb-style":{right:"6px",borderRadius:"5px",background:"rgba(29, 100, 231, 0.2)",width:"5px",opacity:1}},{default:g(()=>[o("div",L,[e.equipments&&e.equipments.length>0?(n(),i("div",H,[(n(!0),i(A,null,k(e.equipments,(a,u)=>(n(),i("div",{class:"col-sm-auto q-pa-xs col-xs-12",key:u},[s(y,U(a,{index:u,status:a.isReported?{tooltip:"Tiene reporte(s) sin atender",color:"#FF9900",label:"Reportado"}:null,"card-action":e.goToDetails}),null,16,["index","status","card-action"])]))),128))])):e.loading?(n(),i("div",j,[s(D,{color:"primary",class:"q-mt-lg",size:"4em"}),J])):e.loading===!1?(n(),i("div",K,[N(" No hay equipos para mostrar "),O])):f("",!0)])]),_:1},8,["thumb-style"])):e.switchContent===2?(n(),c(_,{key:1,class:"w-100",height:"60vh","row-selected":e.rowSelected,"onUpdate:rowSelected":t[3]||(t[3]=a=>e.rowSelected=a),rows:e.rows,columns:e.columns,"actions-table":e.actionsTable,showPagination:!1,loading:e.loading},null,8,["row-selected","rows","columns","actions-table","loading"])):f("",!0)])])])])]),_:1})}var me=C(I,[["render",W],["__scopeId","data-v-5fd193ff"]]);export{me as default};
