import{h as w}from"./QItem.87f7eb07.js";import{Q as q}from"./QForm.85481701.js";import{H as y,Q as v}from"./HeaderActions.f25c2299.js";import{G as D}from"./GeneralTable.329fea1a.js";import{_ as A,d as P,aW as $,s as M,a as u,o as n,c as T,w as d,f as o,e as t,a9 as E,aa as i,a6 as r,a8 as g,am as N,an as k,p as S,i as x}from"./index.650196fd.js";import"./BtnAction.b0c7cc86.js";import"./QInput.d6ff27b1.js";import"./QSpinnerPie.7f041fe1.js";import"./QPagination.5f7621cf.js";import"./use-fullscreen.0a2c208b.js";import"./QChip.f7831cda.js";const F=P({name:"EquipmentsPage",components:{HeaderActions:y,GeneralTable:D},data(){return{btnActions:[{show:!0,btnTitle:"Editar plan",iconName:"o_edit",btnWidth:"auto",loader:!1,tooltip:"Ir a editar plan de mantenimientos",to:this.getIdToEdit()},{show:!0,btnTitle:"Eliminar plan",iconName:"o_delete",btnWidth:"auto",loader:!1,tooltip:"Eliminar el plan de mantenimientos",btnAction:this.removePlan}],btnCloseWindow:{iconName:"exit_to_app",btnBackground:"#FF990020",btnColor:"#FF9900",btnAction:this.goBack},rows:[],rowSelected:{},form:{id:null,planName:"",observations:"",createdAt:"",maintenanceDates:[]},columns:[{name:"categoryName",required:!0,label:"Equipo",align:"left",field:"categoryName",sortable:!0},{name:"equipmentModel",label:"Modelo",field:"equipmentModel",align:"left",sortable:!0},{name:"location",label:"Ubicaci\xF3n",field:"location",align:"left",sortable:!0},{name:"serialNumber",label:"No. serie",field:"serialNumber",align:"center",sortable:!0},{name:"actions",label:"Acciones",field:"actions",align:"center"}],actionsTable:[{icnName:"engineering",icnSize:"xs",icnAction:"Maintenance",tooltip:"Realizarle mantenimiento"}]}},created(){this.checkPermissions(),this.getMaintenancePlan()},computed:{categories(){return this.$store.getters["equipments/getCategoriesGetter"]},sortedDates(){var e,a,s;return((a=(e=this.form)==null?void 0:e.maintenanceDates)==null?void 0:a.length)>=1?[...this.form.maintenanceDates].sort((h,c)=>new Date(h)-new Date(c)):((s=this.form.maintenanceDates)==null?void 0:s.lenght)==0?[]:this.form.maintenanceDates},userRole:{get(){return this.$store.getters["users/getRoleGetter"]}}},watch:{"form.maintenanceDates":{handler(e,a){e&&e!=a&&(this.form.maintenanceDates=Array.isArray(e)?e:[e])},immediate:!0},rowSelected:{handler(e){console.log(e.id),e.action==="Maintenance"&&(console.log(e.id),this.goToMaintenance(e.id))},deep:!0}},methods:{async getMaintenancePlan(){const e={id:this.$route.params.id};this.form={...this.form,...await this.$store.dispatch("maintenancePlans/getMaintenancePlanAction",e)},this.rows=[],this.form.equipments.forEach(a=>{this.rows=[...this.rows,...a.children]})},async goToMaintenance(e){this.$store.commit("equipments/MUTATE_EQUIPMENT",null),this.$store.commit("reports/MUTATE_REPORT",null),await this.getEquipment(e),this.$router.push({name:"add-maintenance"})},async getEquipment(e){await this.$store.dispatch("equipments/getEquipmentAction",{id:e})},async removePlan(){try{this.btnActions[1].loader=!0,await this.$store.dispatch("maintenancePlans/deleteMaintenancePlanAction",this.$route.params.id)===!0?($(this.$q,{title:"\xC9xito al eliminar el plan",msg:"El plan de mantenimientos se ha eliminado"}),this.goBack()):M(this.$q,{msg:"Int\xE9ntalo de nuevo m\xE1s tarde y si el error persiste, rep\xF3rtalo"}),this.btnActions[1].loader=!1}catch(e){console.log(e),this.btnActions[1].loader=!1}},checkPermissions(){switch(this.userRole){case 2:case 3:this.btnActions[0].show=!1,this.btnActions[1].show=!1;break}},getIdToEdit(){return`edit-${this.$route.params.id}-maintenance-plan`},calcDate(e){const a=new Date(e);a.setDate(a.getDate()+1);const s={weekday:"long",day:"numeric",month:"long",year:"numeric"};return a.toLocaleDateString("es-MX",s)},goBack(){this.$router.go(-1)}}}),l=e=>(S("data-v-1081de22"),e=e(),x(),e),I={class:"main-container-page main-container-page-medium-dark container-form"},B={class:"w-100 q-mb-sm"},C={class:"q-pa-sm border-rounded form__label-area bg-accent"},Q=l(()=>t("strong",{class:"q-mr-sm"},"Fecha de creaci\xF3n: ",-1)),R={class:"q-pa-xs"},W={key:0,class:"row items-center"},L=l(()=>t("div",{class:"form__item-label text-weight-medium"}," Nombre del plan ",-1)),U={class:"col-12 form__item-model text-weight-medium"},G={class:"row d-flex justify-between"},H={class:"col-12"},V=l(()=>t("div",{class:"form__item-label text-weight-medium q-mt-lg q-mb-xs"}," Listado de equipos y fechas agendadas para los mantenimientos ",-1)),z={class:"row",style:{gap:"20px"}},j={class:"col-12 col-sm container-table-plans q-mt-sm"},O={class:"col-12 col-sm"},X={class:"text-left chip-date border-rounded q-mt-sm q-pa-xs q-px-sm flex flex-center align-center justify-between"},J={style:{"font-size":"10px"},class:"text-primary q-px-sm"},K={key:1,class:"col-12"},Y=l(()=>t("div",{class:"form__item-label text-weight-medium q-mt-lg q-mb-sm"}," Observaciones ",-1)),Z={style:{height:"80%"},class:"q-pa-sm border-line border-rounded"},ee=["innerHTML"];function te(e,a,s,_,f,h){const c=u("header-actions"),b=u("general-table");return n(),T(v,{class:"flex flex-center cursor-pointer non-selectable"},{default:d(()=>[o(q,{ref:"myForm",class:"card-page"},{default:d(()=>[o(c,{titlePage:"Detalles del plan","btn-actions":e.btnActions,"btn-close-window":e.btnCloseWindow},null,8,["btn-actions","btn-close-window"]),t("div",I,[o(w,{class:"h-97 q-pa-md","thumb-style":e.$store.getters["global/getThumbStyle"]},{default:d(()=>[t("div",B,[t("div",C,[Q,E(" "+i(e.form.createdAt),1)])]),t("div",R,[e.form.planName?(n(),r("div",W,[L,t("div",U,i(e.form.planName),1)])):g("",!0),t("div",G,[t("div",H,[V,t("div",z,[t("div",j,[o(b,{style:{overflow:"scroll"},class:"w-100",height:"auto",rows:e.rows,columns:e.columns,"row-selected":e.rowSelected,"onUpdate:rowSelected":a[0]||(a[0]=m=>e.rowSelected=m),paginationProp:{rowsPerPage:null},"show-pagination":!1,"actions-table":e.actionsTable},null,8,["rows","columns","row-selected","actions-table"])]),t("div",O,[(n(!0),r(k,null,N(e.sortedDates,(m,p)=>(n(),r("div",{key:p},[t("div",X,i(e.calcDate(m)),1),t("div",J,i(p==0?"Primer d\xEDa de mantenimientos":""),1)]))),128))])])])]),e.form.observations?(n(),r("div",K,[Y,t("div",Z,[t("div",{class:"col-12 q-pr-md form__label-area",innerHTML:e.form.observations},null,8,ee)])])):g("",!0)])]),_:1},8,["thumb-style"])])]),_:1},512)]),_:1})}var pe=A(F,[["render",te],["__scopeId","data-v-1081de22"]]);export{pe as default};
