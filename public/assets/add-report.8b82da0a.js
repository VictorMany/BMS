import{h as c}from"./QItem.87f7eb07.js";import{H as g,Q as f}from"./HeaderActions.f25c2299.js";import{F as y}from"./FormComponent.f412702e.js";import{_ as b,d as q,r as s,aW as n,s as l,a as d,o as E,c as A,w as p,e as u,f as o}from"./index.650196fd.js";import"./BtnAction.b0c7cc86.js";import"./QInput.d6ff27b1.js";import"./notification.e1842625.js";import"./warning.551030d0.js";import"./bms.bfdce8d2.js";import"./tecnical_support.43e3eec1.js";import"./QSpinnerPie.7f041fe1.js";import"./QForm.85481701.js";import"./use-fullscreen.0a2c208b.js";import"./QChip.f7831cda.js";import"./QDate.8a7cc956.js";import"./SelectComponent.2f5249cd.js";import"./QEditor.0b50cedd.js";const $=q({name:"Add-Report",components:{HeaderActions:g,FormComponent:y},data(){return{loading:!1,btnAction:{show:!0,btnTitle:"Guardar",iconName:"o_save",btnWidth:"auto",tooltip:"Guardar reporte",btnAction:this.createOrEdit,loader:!1},btnCloseWindow:{iconName:"exit_to_app",btnBackground:"#FF990020",btnColor:"#FF9900",btnAction:this.goBack},fields:{createdAt:this.getCreatedAt(),id:null,top:[{key:"userName",type:"text",label:"Encargado*",model:null,readonly:this.isEditing(),shouldShow:this.isEditing()},{key:"idEquipment",label:"Equipo*",type:"select",options:[],model:null,itemFilter:this.filterEquipments,shouldShow:!this.isEditing(),readonly:this.isEditing(),rules:this.isEditing()?[]:[s.requiredObject]},{key:"categoryName",label:"Categor\xEDa del equipo*",model:"",shouldShow:this.isEditing(),readonly:!0},{key:"equipmentModel",label:"Modelo del equipo*",model:"",shouldShow:this.isEditing(),readonly:!0},{key:"reason",label:"Motivo*",model:"",readonly:this.isEditing(),rules:[s.requiredString]}],left:[{key:"reportUrgency",label:"Prioridad*",type:"select",readonly:this.isEditing(),model:null,options:[{label:"Alta",index:1,value:"Alta"},{label:"Media",index:2,value:"Media"},{label:"Baja",index:3,value:"Baja"}],rules:[s.requiredObject]}],right:[{key:"serialNumber",label:"N\xFAmero de serie*",readonly:!0,model:""},{key:"photo",readImage:!0,model:null,readonly:this.isEditing()}],textareas:[{key:"report",type:"textarea",label:"Detalles del reporte*",required:!0,readonly:this.isEditing(),model:"",toolbar:[[{label:this.$q.lang.editor.fontSize,icon:this.$q.iconSet.editor.fontSize,fixedLabel:!0,fixedIcon:!0,list:"no-icons",options:["size-1","size-2","size-3","size-4"]},"bold","italic","strike","underline"],["unordered","ordered"]]}]}}},methods:{async createReport(){if(await this.$refs.fieldsComponent.validate()){this.btnAction.loader=!0;try{await this.$store.dispatch("reports/postReportAction",this.fields)===!0?(n(this.$q,{title:"\xC9xito al crear el reporte",msg:"El reporte se ha agregado"}),this.$router.go(-1)):l(this.$q,{msg:"Int\xE9ntalo de nuevo m\xE1s tarde y si el error persiste, rep\xF3rtalo"}),this.btnAction.loader=!1}catch{this.btnAction.loader=!1}}},async getReport(){try{const e={id:this.$route.params.id,fields:this.fields};await this.$store.dispatch("reports/getReportAction",e),this.loading=!1}catch(e){this.loading=!1,console.log(e)}},async editReport(){this.btnAction.loader=!0;try{await this.$store.dispatch("reports/updateReportAction",{idReport:this.$route.params.id})===!0?(n(this.$q,{title:"\xC9xito al editar el reporte",msg:"El reporte se ha actualizado"}),this.$router.go(-1)):l(this.$q,{msg:"Int\xE9ntalo de nuevo m\xE1s tarde y si el error persiste, rep\xF3rtalo"}),this.btnAction.loader=!1}catch(e){this.btnAction.loader=!1,console.log(e)}},async getEquipments(e){try{await this.$store.dispatch("equipments/getEquipmentsAction",e)}catch(i){console.log(i)}},async filterEquipments(e,i){if(e===""){await i(async()=>{await this.getEquipments(),this.equipments.map(t=>{t.label=`${t.cardTitle} - ${t.equipmentModel} - No. serie: ${t.serialNumber}`}),this.updateFieldByKeyInAllArrays("idEquipment",{options:this.equipments})});return}else{const t={category:e};this.equipments.length>=12&&(t.rowsPerPage=this.paginationEquipments.totalItems),await this.getEquipments(t)}await i(()=>{this.equipments.map(t=>{t.label=`${t.cardTitle} - ${t.equipmentModel} - No. serie: ${t.serialNumber}`}),this.updateFieldByKeyInAllArrays("idEquipment",{options:this.equipments})})},createOrEdit(){this.isEditing()?this.editReport():this.createReport()},getEquipmentDefault(){this.equipment.categoryName&&!this.fields.top[1].model&&this.updateFieldByKeyInAllArrays("idEquipment",{model:{value:this.equipment.IdEquipment,label:this.equipment.categoryName}}),this.equipment.photo&&this.fields.right[1].model===null&&this.updateFieldByKeyInAllArrays("photo",{model:this.equipment.photo}),this.equipment.serialNumber&&!this.fields.right[0].model&&this.updateFieldByKeyInAllArrays("serialNumber",{model:this.equipment.serialNumber})},updateFieldByKeyInAllArrays(e,i){for(const t in this.fields)if(Array.isArray(this.fields[t])){const r=this.fields[t].find(a=>a.key===e);if(r){Object.assign(r,i);return}}console.error(`No se encontr\xF3 la entrada para la clave '${e}' en ning\xFAn arreglo o no tiene opciones.`)},getDate(){return this.$store.$store.getters["global/getDate"]},goBack(){this.$router.go(-1)},getTitle(){return this.isEditing()?"Editar reporte":"Agregar reporte"},getCreatedAt(){return this.isEditing()?"":this.$store.getters["global/getDate"]},isEditing(){return!!this.$route.params.id}},created(){this.loading=!0,this.getEquipments(),this.isEditing()?this.getReport():this.loading=!1},mounted(){this.equipment&&this.getEquipmentDefault()},computed:{equipments:{get(){return this.$store.getters["equipments/getEquipmentsGetter"]}},equipment:{get(){return this.$store.getters["equipments/getEquipmentGetter"]}},paginationEquipments:{get(){return this.$store.getters["equipments/getPaginationGetter"]}}},watch:{fields:{handler(e){e.top[1].model&&e.right[1].model!=e.top[1].model.serialNumber&&e.top[1].model.serialNumber&&!this.isEditing()&&(this.updateFieldByKeyInAllArrays("photo",{model:e.top[1].model.cardImg}),this.updateFieldByKeyInAllArrays("serialNumber",{model:e.top[1].model.serialNumber}))},deep:!0,immediate:!0}}}),_={class:"card-page"},w={class:"main-container-page main-container-page-medium-dark container-form"};function N(e,i,t,r,a,k){const m=d("header-actions"),h=d("form-component");return E(),A(f,{class:"flex flex-center cursor-pointer non-selectable"},{default:p(()=>[u("div",_,[o(m,{titlePage:e.getTitle(),"btn-action":e.btnAction,"btn-close-window":e.btnCloseWindow},null,8,["titlePage","btn-action","btn-close-window"]),u("div",w,[o(c,{class:"h-97 q-pa-xs-none q-pa-lg-sm","thumb-style":e.$store.getters["global/getThumbStyle"]},{default:p(()=>[o(h,{ref:"fieldsComponent",loading:e.loading,fields:e.fields},null,8,["loading","fields"])]),_:1},8,["thumb-style"])])])]),_:1})}var W=b($,[["render",N],["__scopeId","data-v-7412ea92"]]);export{W as default};
