import{Q as f}from"./QSpinnerPie.7f041fe1.js";import{h as b}from"./QItem.87f7eb07.js";import{Q as w}from"./QPagination.5f7621cf.js";import{H as q,Q as P}from"./HeaderActions.f25c2299.js";import{G as y}from"./GeneralTable.329fea1a.js";import{I as v}from"./ItemCard.0c2ebc42.js";import{_ as T,d as S,a as l,o as n,c,w as h,e as s,f as r,a7 as C,a6 as i,an as M,am as $,a9 as A,a8 as d,ao as E}from"./index.650196fd.js";import"./BtnAction.b0c7cc86.js";import"./QInput.d6ff27b1.js";import"./use-fullscreen.0a2c208b.js";import"./QChip.f7831cda.js";import"./QCard.9e15fa18.js";const k=S({name:"MaintenancesPage",components:{HeaderActions:q,GeneralTable:y,ItemCard:v},data(){var e,t;return{delaySearch:300,searchModel:null,timeoutSearch:null,loading:!0,switchContent:1,localPagination:{totalPages:1,descending:!1,rowsPerPage:12,page:1},btnAction:{show:!0,btnTitle:"Agregar mantenimiento",tooltip:"Agregar nuevo mantenimiento",btnAction:this.goToAddMaintenance,btnWidth:"auto"},btnCloseWindow:{iconName:"exit_to_app",btnBackground:"#FF990020",btnColor:"#FF9900",btnAction:this.goBack,shouldHide:((e=this.$route.query)==null?void 0:e.equipment)||((t=this.$route.query)==null?void 0:t.user)},columns:[{name:"encharged_name",label:"Encargado",field:"encharged_name",align:"left",sortable:!0},{name:"equipment",label:"Equipo",field:"equipment",align:"left",sortable:!0},{name:"date",label:"Fecha de mantenimiento",field:"date",align:"left",sortable:!0},{name:"badge",required:!0,label:"Tipo",align:"center",field:o=>o.status,sortable:!0},{name:"actions",label:"Acciones",field:"actions",align:"center"}],actionsTable:[{icnName:"read_more",icnSize:"sm",icnAction:"Detail",tooltip:"Detalle de mantenimiento"}],rowSelected:{},selectedFilterText:"userName",inputSearch:{show:!0,inputLabel:"Encargado",setSelectedFilter:this.setSelectedFilter,setSelectedOptionFilter:this.setSelectedOptionFilter,heightModal:200,items:[{title:"Tipo",icon:"o_engineering",options:[{title:"Correctivo",filter:"maintenanceType",value:"Correctivo"},{title:"Preventivo",filter:"maintenanceType",value:"Preventivo"}]},{title:"Encargado",filter:"userName",icon:"o_supervisor_account"},{title:"Categor\xEDa",filter:"category",icon:"o_badge"}]},params:{reason:""}}},mounted(){this.$route.query.equipment?(this.params.IdEquipment=this.$route.query.equipment,this.btnAction.show=this.equipment.equipmentStatus):this.$route.query.user&&(this.params.userId=this.$route.query.user),this.getMaintenances()},watch:{rowSelected:{handler(e){e.action==="Detail"&&this.goToDetails(e.id)},deep:!0},searchModel(e){this.params[this.selectedFilterText]=e,clearTimeout(this.timeoutSearch),this.timeoutSearch=setTimeout(()=>{this.params.page=1,this.getMaintenances()},this.delaySearch)}},computed:{maintenances:{get(){return this.$store.getters["maintenances/getMaintenancesGetter"]}},pagination:{get(){return this.$store.getters["maintenances/getPaginationGetter"]}},cards(){return this.maintenances.map(e=>({id:e.id,cardTitle:e.equipment,status:this.findIndicator(e.status),cardLabels:[{label:"Encargado",info:e.encharged_name}]}))},equipment:{get(){return this.$store.getters["equipments/getEquipmentGetter"]}}},methods:{async getMaintenances(){this.loading=!0,await this.$store.dispatch("maintenances/getMaintenancesAction",this.params),this.localPagination=JSON.parse(JSON.stringify(this.pagination)),this.loading=!1},findIndicator(e){return e==="Preventivo"?{tooltip:"El mantenimiento es preventivo",color:"#10D13A",label:"Preventivo"}:{tooltip:"El mantenimiento es correctivo",color:"#d1b410",label:"Correctivo"}},goToAddMaintenance(){this.$store.commit("reports/MUTATE_REPORT",null),this.$route.query.equipment||this.$store.commit("equipments/MUTATE_EQUIPMENT",null),this.$router.push({name:"add-maintenance"})},showCloseBtn(){var e,t;return((e=this.$route.query)==null?void 0:e.equipment)||((t=this.$route.query)==null?void 0:t.user)},goToDetails(e){this.$router.push({name:"detail-maintenance",params:{id:e}})},setSelectedFilter(e){this.selectedFilterText&&(delete this.params[this.selectedFilterText],this.searchModel&&this.getMaintenances()),this.selectedFilterText=e.filter,this.inputSearch.inputLabel=e.title,e.value&&e.filter&&(this.params[e.filter]=this.searchModel,this.getMaintenances())},setSelectedOptionFilter(e,t=null){e.length&&e.forEach(o=>{this.params[o.filter]=o.value}),t&&delete this.params[t],this.params.page=1,this.getMaintenances()},changePagination(e){this.localPagination.page=e,this.params={...this.params,page:this.localPagination.page,rowsPerPage:this.localPagination.rowsPerPage},this.getMaintenances()},goBack(){this.$router.go(-1)}}}),F={class:"card-page"},N={style:{"max-width":"100%"}},B={key:0,class:"row container-cards"},_={key:1,class:"q-ma-md q-ma-sm-xl q-pa-xl text-center no-info border-rounded"},Q=s("div",{class:"text-primary q-ma-lg"},"Cargando mantenimientos",-1),U={key:2,class:"q-ma-md q-ma-sm-xl q-pa-xl text-center no-info border-rounded"},V=s("strong",{class:"text-negative"},"!",-1),D={key:1,style:{height:"6.55%"},class:"row justify-center q-pt-sm"};function I(e,t,o,O,G,z){const u=l("header-actions"),g=l("item-card"),p=l("general-table");return n(),c(P,{class:"flex flex-center cursor-pointer non-selectable"},{default:h(()=>[s("div",F,[r(u,{titlePage:"Mantenimientos",btnAction:e.btnAction,"btn-close-window":e.showCloseBtn()?e.btnCloseWindow:null,inputSearch:e.inputSearch,searchModel:e.searchModel,"onUpdate:searchModel":t[0]||(t[0]=a=>e.searchModel=a),"switch-content":e.switchContent,"onUpdate:switchContent":t[1]||(t[1]=a=>e.switchContent=a)},null,8,["btnAction","btn-close-window","inputSearch","searchModel","switch-content"]),s("div",{class:C(["main-container-page q-pa-sm",{"card-color main-container-page-dark":e.switchContent===1}])},[e.switchContent===1?(n(),c(b,{key:0,style:{height:"93% !important"},class:"fit","thumb-style":e.$store.getters["global/getThumbStyle"]},{default:h(()=>[s("div",N,[e.maintenances.length>0?(n(),i("div",B,[(n(!0),i(M,null,$(e.cards,(a,m)=>(n(),i("div",{key:m,class:"col-xs-12 col-sm-auto col-md-auto col-lg-auto col-xl-auto"},[r(g,E(a,{index:m,"card-action":e.goToDetails}),null,16,["index","card-action"])]))),128))])):e.loading?(n(),i("div",_,[r(f,{color:"primary",class:"q-mt-lg",size:"4em"}),Q])):e.loading===!1?(n(),i("div",U,[A(" No hay mantenimientos para mostrar "),V])):d("",!0)])]),_:1},8,["thumb-style"])):d("",!0),e.switchContent===1&&e.maintenances.length>0?(n(),i("div",D,[r(w,{modelValue:e.localPagination.page,"onUpdate:modelValue":[t[2]||(t[2]=a=>e.localPagination.page=a),e.changePagination],dense:"",class:"q-mt-none pagination-style",max:e.localPagination.totalPages,size:"md","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])):e.switchContent===2?(n(),c(p,{key:2,"row-selected":e.rowSelected,"onUpdate:rowSelected":t[3]||(t[3]=a=>e.rowSelected=a),height:"100%",rows:e.maintenances,loading:e.loading,columns:e.columns,"actions-table":e.actionsTable,"pagination-prop":e.pagination,onChangePagination:e.changePagination},null,8,["row-selected","rows","loading","columns","actions-table","pagination-prop","onChangePagination"])):d("",!0)],2)])]),_:1})}var te=T(k,[["render",I]]);export{te as default};
