import{h as d}from"./QItem.87f7eb07.js";import{H as c,Q as h}from"./HeaderActions.f25c2299.js";import{F as y}from"./FormComponent.f412702e.js";import{_ as g,d as f,r as s,aW as b,s as q,a as n,o as E,c as _,w as l,e as m,f as a}from"./index.650196fd.js";import"./BtnAction.b0c7cc86.js";import"./QInput.d6ff27b1.js";import"./notification.e1842625.js";import"./warning.551030d0.js";import"./bms.bfdce8d2.js";import"./tecnical_support.43e3eec1.js";import"./QSpinnerPie.7f041fe1.js";import"./QForm.85481701.js";import"./use-fullscreen.0a2c208b.js";import"./QChip.f7831cda.js";import"./QDate.8a7cc956.js";import"./SelectComponent.2f5249cd.js";import"./QEditor.0b50cedd.js";const $=f({name:"EquipmentsPage",components:{HeaderActions:c,FormComponent:y},data(){return{btnAction:{show:!0,btnTitle:"Guardar",iconName:"o_save",btnWidth:"auto",tooltip:"Agregar mantenimiento",btnAction:this.createMaintenance,loader:!1},btnCloseWindow:{iconName:"exit_to_app",btnBackground:"#FF990020",btnColor:"#FF9900",btnAction:this.goBack},fields:{createdAt:this.getCreatedAt(),id:null,reportRelated:null,top:[{key:"idEquipment",label:"Equipo*",type:"select",itemFilter:this.filterEquipments,options:[],model:null,rules:[s.requiredObject]},{key:"reason",label:"Motivo*",model:"",rules:[s.requiredString]}],left:[{key:"maintenanceType",label:"Tipo*",model:"",type:"select",options:[{label:"Preventivo",index:1,value:"Preventivo"},{label:"Correctivo",index:2,value:"Correctivo"}],rules:[s.requiredObject]},{key:"cost",label:"Costo*",type:"number",prefix:"$",model:"",rules:[s.requiredString]}],textareas:[{key:"tools",type:"textarea",label:"Herramientas*",required:!0,model:""},{key:"materials",type:"textarea",label:"Materiales*",required:!0,model:""}],right:[{key:"serialNumber",label:"N\xFAmero de serie",readonly:!0,model:""},{key:"photo",readImage:!0,model:null}],bottom:[{key:"observations",type:"textarea",label:"Actividades y observaciones del mantenimiento",required:!1,model:""}]},defaultEquipment:null}},methods:{async createMaintenance(){if(this.report&&(this.fields.reportRelated=this.report.ReportId),await this.$refs.fieldsComponent.validate()){this.btnAction.loader=!0;try{await this.$store.dispatch("maintenances/postMaintenanceAction",this.fields)===!0?(b(this.$q,{title:"\xC9xito al crear el mantenimiento",msg:"El mantenimiento se ha agregado"}),this.$router.go(-1)):q(this.$q,{msg:"Int\xE9ntalo de nuevo m\xE1s tarde y si el error persiste, rep\xF3rtalo"}),this.btnAction.loader=!1}catch{this.btnAction.loader=!1}}},async getMaintenance(){try{const e={id:this.$route.params.id,fields:this.fields};await this.$store.dispatch("maintenances/getMaintenanceAction",e)}catch(e){console.log(e)}},async getEquipments(e){try{await this.$store.dispatch("equipments/getEquipmentsAction",e)}catch(i){console.log(i)}},getDate(){return this.$store.$store.getters["global/getDate"]},goBack(){this.$router.go(-1)},getCreatedAt(){return this.$store.getters["global/getDate"]},async filterEquipments(e,i){if(e===""){await i(async()=>{await this.getEquipments(),this.equipments.map(t=>{t.label=`${t.cardTitle} - ${t.equipmentModel} - No. serie: ${t.serialNumber}`}),this.updateFieldByKeyInAllArrays("idEquipment",{options:this.equipments})});return}else{const t={category:e};this.equipments.length>=12&&(t.rowsPerPage=this.paginationEquipments.totalItems),await this.getEquipments(t)}await i(()=>{this.equipments.map(t=>{t.label=`${t.cardTitle} - ${t.equipmentModel} - No. serie: ${t.serialNumber}`}),this.updateFieldByKeyInAllArrays("idEquipment",{options:this.equipments})})},getEquipmentDefault(){this.setModelValueByKey("idEquipment",{value:this.equipment.IdEquipment,label:this.equipment.categoryName}),this.setModelValueByKey("photo",this.equipment.photo),this.setModelValueByKey("serialNumber",this.equipment.serialNumber)},getEquipmentFromReport(){this.setModelValueByKey("idEquipment",{value:this.report.Equipment.IdEquipment,label:this.report.Equipment.categoryName}),this.setModelValueByKey("maintenanceType",{value:"Correctivo",label:"Correctivo"}),this.setModelValueByKey("photo",this.report.Equipment.photo),this.setModelValueByKey("serialNumber",this.report.Equipment.serialNumber),this.setModelValueByKey("observations","Mantenimiento a causa de un reporte por: "+this.report.reason)},setModelValueByKey(e,i){for(const t in this.fields)if(Object.prototype.hasOwnProperty.call(this.fields,t)){const r=this.fields[t];if(r&&typeof r[Symbol.iterator]=="function"){for(const o of r)if(o.key===e){o.model=i;return}}}},updateFieldByKeyInAllArrays(e,i){for(const t in this.fields)if(Array.isArray(this.fields[t])){const r=this.fields[t].find(o=>o.key===e);if(r){Object.assign(r,i);return}}console.error(`No se encontr\xF3 la entrada para la clave '${e}' en ning\xFAn arreglo o no tiene opciones.`)}},created(){this.getEquipments({})},mounted(){this.equipment?this.getEquipmentDefault():this.report&&this.getEquipmentFromReport()},computed:{report:{get(){return this.$store.getters["reports/getReportGetter"]}},equipments:{get(){return this.$store.getters["equipments/getEquipmentsGetter"]}},equipment:{get(){return this.$store.getters["equipments/getEquipmentGetter"]}},paginationEquipments:{get(){return this.$store.getters["equipments/getPaginationGetter"]}}},watch:{fields:{handler(e){e.top[0].model&&e.right[1].model!=e.top[0].model.serialNumber&&e.top[0].model.serialNumber&&(this.setModelValueByKey("photo",e.top[0].model.cardImg),this.setModelValueByKey("serialNumber",e.top[0].model.serialNumber))},deep:!0,immediate:!0}}}),A={class:"card-page"},v={class:"main-container-page main-container-page-medium-dark container-form"};function M(e,i,t,r,o,w){const p=n("header-actions"),u=n("form-component");return E(),_(h,{class:"flex flex-center cursor-pointer non-selectable"},{default:l(()=>[m("div",A,[a(p,{titlePage:"Agregar mantenimiento","btn-action":e.btnAction,"btn-close-window":e.btnCloseWindow},null,8,["btn-action","btn-close-window"]),m("div",v,[a(d,{class:"h-97 q-pa-xs-none q-pa-lg-sm","thumb-style":e.$store.getters["global/getThumbStyle"]},{default:l(()=>[a(u,{ref:"fieldsComponent",fields:e.fields},null,8,["fields"])]),_:1},8,["thumb-style"])])])]),_:1})}var j=g($,[["render",M],["__scopeId","data-v-71bc7242"]]);export{j as default};
