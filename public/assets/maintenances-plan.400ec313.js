import{Q as u}from"./QSpinnerPie.7f041fe1.js";import{h as P}from"./QItem.87f7eb07.js";import{Q as w}from"./QPagination.5f7621cf.js";import{H as b,Q as f}from"./HeaderActions.f25c2299.js";import{G as C}from"./GeneralTable.329fea1a.js";import{_ as y,d as S,aW as N,s as k,a as r,o as n,c as l,w as m,e as s,f as o,a7 as M,a6 as i,an as A,am as T,a9 as $,a8 as c,ao as q}from"./index.650196fd.js";import{I as v}from"./ItemCard.0c2ebc42.js";import"./BtnAction.b0c7cc86.js";import"./QInput.d6ff27b1.js";import"./use-fullscreen.0a2c208b.js";import"./QChip.f7831cda.js";import"./QCard.9e15fa18.js";const E=S({name:"MaintenancesPlan",components:{HeaderActions:b,GeneralTable:C,ItemCard:v},data(){return{delaySearch:300,searchModel:null,timeoutSearch:null,switchContent:1,loading:!0,localPagination:{},btnAction:{show:!0,btnTitle:"Agregar plan de mantenimiento",tooltip:"Agregar nuevo plan",to:"add-maintenance-plan",btnWidth:"auto"},btnCloseWindow:{iconName:"exit_to_app",btnBackground:"#FF990020",btnColor:"#FF9900",btnAction:this.goBack},columns:[{name:"planName",required:!0,label:"Nombre del plan",align:"left",field:"planName",format:e=>`${e}`,sortable:!0},{name:"user",label:"Encargado",field:"user",align:"left",sortable:!0},{name:"date",label:"Fecha de creaci\xF3n",field:"date",align:"center",sortable:!0},{name:"actions",label:"Acciones",field:"actions",align:"center"}],actionsTable:[{icnName:"read_more",icnSize:"sm",icnAction:"Detail",tooltip:"Detalle de plan"},{icnName:"o_edit",icnSize:"xs",icnAction:"Edit",tooltip:"Editar plan"},{icnName:"o_delete",icnSize:"xs",icnAction:"Remove",tooltip:"Eliminar plan"}],rowSelected:{},selectedFilterText:"planName",inputSearch:{show:!0,inputLabel:"Nombre del plan"},params:{planName:""},paginationCards:{descending:!1,rowsPerPage:12,page:1}}},mounted(){this.checkPermissions(),this.getMaintenancePlans()},watch:{rowSelected:{handler(e){e.action==="Edit"?this.goToEdit(e.id):e.action==="Detail"?this.goToDetails(e.id):e.action==="Remove"&&this.removePlan(e.id)},deep:!0},searchModel(e){this.params[this.selectedFilterText]=e,clearTimeout(this.timeoutSearch),this.timeoutSearch=setTimeout(()=>{this.params.page=1,this.getMaintenancePlans()},this.delaySearch)},pagination:{handler(e){this.paginationCards.rowsPerPage=e.rowsPerPage,this.paginationCards.pagesNumber=e.totalPages,this.paginationCards.rowsNumber=e.rowsNumber},immediate:!0,deep:!0},switchContent:{handler(e){e===1?this.paginationCards.page=this.pagination.page:this.pagination.page=this.paginationCards.page},deep:!0}},computed:{maintenancePlans:{get(){return this.$store.getters["maintenancePlans/getMaintenancePlansGetter"]}},pagination:{get(){return this.$store.getters["maintenancePlans/getPaginationGetter"]}},cards(){return this.maintenancePlans.map(e=>({id:e.id,cardTitle:e.planName,cardLabels:[{label:"Encargado",info:e.user}]}))},userRole:{get(){return this.$store.getters["users/getRoleGetter"]}}},methods:{async getMaintenancePlans(){this.loading=!0,this.localPagination={...this.localPagination,...await this.$store.dispatch("maintenancePlans/getMaintenancePlansAction",this.params)},this.loading=!1},async removePlan(e){try{await this.$store.dispatch("maintenancePlans/deleteMaintenancePlanAction",e)===!0?(N(this.$q,{title:"\xC9xito al eliminar el plan",msg:"El plan de mantenimientos se ha eliminado"}),this.getMaintenancePlans()):k(this.$q,{msg:"Int\xE9ntalo de nuevo m\xE1s tarde y si el error persiste, rep\xF3rtalo"})}catch(a){console.log(a)}},checkPermissions(){switch(this.userRole){case 2:case 3:this.btnAction.show=!1;break}},goToDetails(e){this.$router.push({name:"detail-maintenance-plan",params:{id:e}})},goToEdit(e){this.$router.push({name:"edit-maintenance-plan",params:{id:e}})},changePagination(e){this.params={...this.params,page:e.page,rowsPerPage:e.rowsPerPage},this.getMaintenancePlans()},changePaginationCards(e){this.params={...this.params,page:e,rowsPerPage:12},this.getMaintenancePlans()},goBack(){this.$router.go(-1)}}}),F={class:"card-page"},V={style:{"max-width":"100%"}},B={key:0,class:"row container-cards"},Q={key:1,class:"q-ma-md q-ma-sm-xl q-pa-xl text-center no-info border-rounded"},z=s("div",{class:"text-primary q-ma-lg"},"Cargando planes de mantenimientos",-1),D={key:2,class:"q-ma-md q-ma-sm-xl q-pa-xl text-center no-info border-rounded"},G=s("strong",{class:"text-negative"},"!",-1),R={key:1,style:{height:"6.55%"},class:"row justify-center q-pt-sm"};function U(e,a,W,_,I,L){const p=r("header-actions"),g=r("item-card"),h=r("general-table");return n(),l(f,{class:"flex flex-center cursor-pointer non-selectable"},{default:m(()=>[s("div",F,[o(p,{titlePage:"Planes de mantenimientos",btnAction:e.btnAction,inputSearch:e.inputSearch,searchModel:e.searchModel,"onUpdate:searchModel":a[0]||(a[0]=t=>e.searchModel=t),"switch-content":e.switchContent,"onUpdate:switchContent":a[1]||(a[1]=t=>e.switchContent=t)},null,8,["btnAction","inputSearch","searchModel","switch-content"]),s("div",{class:M(["main-container-page q-pa-sm",{"card-color main-container-page-dark":e.switchContent===1}])},[e.switchContent===1?(n(),l(P,{key:0,style:{height:"93% !important"},class:"fit","thumb-style":e.$store.getters["global/getThumbStyle"]},{default:m(()=>[s("div",V,[e.maintenancePlans.length>0?(n(),i("div",B,[(n(!0),i(A,null,T(e.cards,(t,d)=>(n(),i("div",{key:d,class:"col-xs-12 col-sm-auto col-md-auto col-lg-auto col-xl-auto"},[o(g,q(t,{index:d,"card-action":e.goToDetails}),null,16,["index","card-action"])]))),128))])):e.loading?(n(),i("div",Q,[o(u,{color:"primary",class:"q-mt-lg",size:"4em"}),z])):e.loading===!1?(n(),i("div",D,[$(" No hay planes para mostrar "),G])):c("",!0)])]),_:1},8,["thumb-style"])):c("",!0),e.switchContent===1&&e.maintenancePlans.length>0?(n(),i("div",R,[o(w,{modelValue:e.paginationCards.page,"onUpdate:modelValue":[a[2]||(a[2]=t=>e.paginationCards.page=t),e.changePaginationCards],dense:"",class:"q-mt-none pagination-style",max:e.paginationCards.pagesNumber,size:"md","direction-links":""},null,8,["modelValue","max","onUpdate:modelValue"])])):e.switchContent===2?(n(),l(h,{key:2,"row-selected":e.rowSelected,"onUpdate:rowSelected":a[3]||(a[3]=t=>e.rowSelected=t),height:"100%",rows:e.maintenancePlans,loading:e.loading,columns:e.columns,"actions-table":e.actionsTable,"pagination-prop":e.localPagination,onChangePagination:e.changePagination},null,8,["row-selected","rows","loading","columns","actions-table","pagination-prop","onChangePagination"])):c("",!0)],2)])]),_:1})}var ne=y(E,[["render",U]]);export{ne as default};
